<!DOCTYPE html>
<html lang="de-de">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<style type=text/css>body{font-family:monospace;}</style>
	<title>WLanRelais</title>
	<meta name="description" content="Personal blog">
	<meta name="author" content="Manfred Caspar">
	<link rel="stylesheet" href="/css/style.css">
	
	
</head>
<body>
	<header>
	------<br>
	  <a href="http://22x22.de/">mancas</a> <br>
	------
	<div style="float: right;"></div><br>
	<p>
	<nav>
			<a href="/"><b>Start</b></a>.
			
			
			<a href="/posts/"><b>Laufendes Projekt</b></a>.
			
			<a href="/%C3%BCber-diese-seite/about"><b>Über diese Seite</b></a>.
			
	</nav>
	</p>
	
</header>

	
	<main>
		<article>
			<h1>WLanRelais</h1>
			<b><time>2021-01-18 13:25:00</time></b>
		       

			<div>
				<p>In meinem WLan möchte ich ein Gerät nach Eingabe eines Passwortes schalten.</p>
<h3 id="der-esp32">Der ESP32</h3>
<p>Der ESP32 kann mit dem AsyncWebserver eine Internetseite aufbauen. <br />
Er bekommt eine Relaisstufe und schaltet nach eingabe des korrekten Passwortes.</p>
<p><img src="/images/WLanRelais/WLanRelaisAufbau.jpg" alt="WLanRelaisAufbau.jpg" /></p>
<p>Von den beiden Relais wird mit diesem Code nur eines genutzt.</p>
<pre tabindex="0"><code>/*********
  Verify a code on a website and then open a relay for 5 sec.  
  mancas @ lug-saar.de
*********/

#include &lt;Arduino.h&gt;
#ifdef ESP32
  #include &lt;WiFi.h&gt;
  #include &lt;AsyncTCP.h&gt;
#else
  #include &lt;ESP8266WiFi.h&gt;
  #include &lt;ESPAsyncTCP.h&gt;
#endif
#include &lt;ESPAsyncWebServer.h&gt;


// CREDENTIALS
const char* ssid =     &#34;xxxxx&#34;; //Replace with your data
const char* password = &#34;xxxxx&#34;;
String CodeToVerify =  &#34;xxxxx&#34;;

//bool ledStat = 0;
const int ledPin = 16;

const char* PARAM_INPUT_1 = &#34;input1&#34;;
String globalinputMessage;  // Website input

AsyncWebServer server(80);

// HTML web page to handle input
const char index_html[] PROGMEM = R&#34;rawliteral(
&lt;!DOCTYPE HTML&gt;&lt;html&gt;&lt;head&gt;
  &lt;title&gt;22x22.org&lt;/title&gt;
  &lt;meta name=&#34;viewport&#34; content=&#34;width=device-width, initial-scale=1&#34;&gt;
  &lt;/head&gt;&lt;body&gt;
  &lt;br&gt;
  &lt;br&gt;&lt;br&gt;
   &lt;form action=&#34;/get&#34;&gt;
  input1: &lt;input type=&#34;text&#34; name=&#34;input1&#34;&gt;
  &lt;input type=&#34;submit&#34; value=&#34;Submit&#34;&gt;
&lt;/form&gt;&lt;br&gt;
&lt;/body&gt;&lt;/html&gt;)rawliteral&#34;;

void notFound(AsyncWebServerRequest *request) {
  request-&gt;send(404, &#34;text/plain&#34;, &#34;Not found&#34;);
}


void setup() {
  Serial.begin(115200);

  pinMode(ledPin, OUTPUT);
  digitalWrite(ledPin, HIGH); //LOW
Serial.println(&#34;ledPin is HIGH&#34;);
  
  WiFi.mode(WIFI_STA);
  WiFi.begin(ssid, password);

  
  if (WiFi.waitForConnectResult() != WL_CONNECTED) {
    Serial.println(&#34;WiFi Failed!&#34;);
    return;
  }
  Serial.println();
  Serial.print(&#34;IPv4 Address: &#34;);
  Serial.println(WiFi.localIP());
  
 Serial.println(&#34;Starte Webserver&#34;);

  // Send web page with input fields to client
  server.on(&#34;/&#34;, HTTP_GET, [](AsyncWebServerRequest *request){
    request-&gt;send_P(200, &#34;text/html&#34;, index_html);
  });
  
  // Send a GET request to &lt;ESP_IP&gt;/get?input1=&lt;inputMessage&gt;
  server.on(&#34;/get&#34;, HTTP_GET, [] (AsyncWebServerRequest *request) {
   String inputMessage;
   String inputParam;
   
    // GET input1 value on &lt;ESP_IP&gt;/get?input1=&lt;inputMessage&gt;
    
    if (request-&gt;hasParam(PARAM_INPUT_1)) {
      inputMessage = request-&gt;getParam(PARAM_INPUT_1)-&gt;value();
      inputParam = PARAM_INPUT_1;
      globalinputMessage = inputMessage; //gebe weiter an globale Variable
    }
    
  
    else {
      inputMessage = &#34;No message sent&#34;;
      inputParam = &#34;none&#34;;
    }
    
    Serial.println(inputMessage);
    request-&gt;send(200, &#34;text/html&#34;, &#34;&lt;br&gt;&lt;a href=\&#34;/\&#34;&gt;You got it &lt;/a&gt;&#34;); 
    
    }

);

  server.onNotFound(notFound);
  server.begin();

}

void loop() {

//compare with your code
if (globalinputMessage == CodeToVerify) {
  digitalWrite(ledPin, LOW); //HIGH
  Serial.print(PARAM_INPUT_1);
  Serial.println(&#34;  Taster für 7 sec eingeschaltet  &#34;);
  delay(7000);
  digitalWrite(ledPin, HIGH); //LOW
  Serial.print(PARAM_INPUT_1);
  Serial.println(&#34;  Taster ist wieder ausgeschaltet  &#34;);
  globalinputMessage = &#34;0&#34;;
  }

}
</code></pre><!-- blank line -->
<br>
<!-- blank line -->
<p>Alles in ein kleines 3D-gedrucktes Wandgehäuse eingebaut.<br />
<img src="/images/WLanRelais/WLanRelaisEinbau.jpg" alt="WLanRelaisEinbau.jpg" /></p>
<!-- blank line -->
<br>
<!-- blank line -->

			</div>
		</article>
	</main>
<aside>
	<div>
		<div>
			<h3>LATEST POSTS</h3>
		</div>
		<div>
			<ul>
				
				<li><a href="/posts/webradio/">WebRadio</a></li>
				
				<li><a href="/posts/3d-druck/">3D-Druck</a></li>
				
				<li><a href="/posts/stencil3ddruck/">3D-Druck eines Stencil-Halters</a></li>
				
				<li><a href="/posts/laserscan/">3D Laser Scanner</a></li>
				
				<li><a href="/posts/wlanrelais/">WLanRelais</a></li>
				
			</ul>
		</div>
	</div>
</aside>


	<footer>
	<p>&copy; 2022 <a href="http://22x22.de/"><b>mancas</b></a>.
	<a href="/impressum/impressum"><b>Impressum</b></a>.
	</p>
</footer>

</body>
</html>
